@model IEnumerable<ProprioInfini.Annonce>

@foreach(ProprioInfini.Annonce item2 in ViewBag.listBatisse)
{
    <div class="geoloco" id="@item2.Batiment.Adresse.NumeroCivic  @item2.Batiment.Adresse.Rue.Nom  @item2.Batiment.Adresse.Ville.Nom"></div>
    
}
@{
    ViewBag.Title = "Index";
}



<h2>Index</h2>

<p>
    @Html.ActionLink("Create New", "Create")
</p>
<table>
    <tr>
        <th>
            Nom du Proprio
        </th>
        <th>
            @Html.DisplayNameFor(model => model.DateDebutAnnonce)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.DateFinAnnonce)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Prix)
        </th>
        <th>
            Batiment
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Titre)
        </th>
        <th></th>
    </tr>




@foreach (var item in Model) 
{
    
    <tr>
        <td>
            @Html.ActionLink(item.Proprietaire.Nom, "Details","Proprietaire", new { id = item.ProprietaireId }, null)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.DateDebutAnnonce)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.DateFinAnnonce)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Prix)
        </td>
        <td>
           @Html.ActionLink(item.Batiment.Nom, "Details","Batiment", new { id = item.BatimentId }, null)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Titre)
        </td>
        <td>
            @Html.ActionLink("Edit", "Edit", new { id=item.Id }) |
            @Html.ActionLink("Details", "Details", new { id=item.Id }) |
            @Html.ActionLink("Delete", "Delete", new { id=item.Id })
        </td>
    </tr>
}


    <br />
    <br />
    <h3>Carte d'annonce</h3>
    <div id="map" style="width: 900px; height: 500px"></div>
    <script type="text/javascript"    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB79nxD4iV9QrmpHO2Q5Jd2bkIaKjEh3S8&sensor=false"> </script>
    <script src="http://code.jquery.com/jquery-1.10.2.min.js" type="text/javascript"></script>


<script type="text/javascript">
    //window.onload(initialize());

    $(document).ready(function () {
        initialize();
    });
    var contentString;
    function initialize()
    {

        var mapOptions =
        {
            center: new google.maps.LatLng(45.4959944, -73.5693213),
            zoom: 8,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(document.getElementById("map"), mapOptions);



        $('.geoloco').each(function ()
        {
            var add = $(this).attr('id');
            addPoint(map, add);

        });
       // addPoint(map, new google.maps.LatLng(45.539121, -73.492355));
    }


    function addPoint(map, adresse)
    {
        var geocoder = new google.maps.Geocoder();
        geocoder.geocode({ 'address': adresse }, function (results, status)
        {
            if (status == google.maps.GeocoderStatus.OK)
            {
                
               

                marker = new google.maps.Marker(
                {
                    position: results[0].geometry.location,
                    map: map
                });
                google.maps.event.addListener(marker, 'click', function () {
                    adresseMAP(adresse,map, marker);
                });
            }
            else
                alert('Geocode was not successful for the following reason: ' + status);
        });

    }

    function adresseMAP(adresse, map, marker)
    {
        $.ajax({
            url: '@Url.Action("AdresseMAPPartial", "Annonce")',
            data: { adresse: adresse },
            type: 'POST',
            success: function (data) {
                contentString = data;
                var infowindow = new google.maps.InfoWindow({
                    content: contentString
                });
                infowindow.open(map, marker);
            }
        });
    }
    </script>

</table>